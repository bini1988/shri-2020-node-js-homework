# shri-2020-node-js-homework

Домашнее задание к лекции Node.js

## Production режим

### Для запуска серверной части проекта в production режиме (c поддержкой SSR)

- Добавить в файл `.env` параметр API_TOKEN - хэш ключа авторизации к серверному API
- Запустить сервер коммандой `npm run start`
- Перейти по адресу `http://127.0.0.1:3030/`

### Для сборки клиенсткой части проекта в production режиме с поддержкой SSR

- Запустить сборку коммандой `npm run build:client`

## Development режим

### Для запуска серверной части проекта в development режиме

Без поддержки SSR, с nodemon (перезапуск сервера на изменение файлов) и ведением логов в консоль

### Для запуска серверной части проекта в development режиме

- Добавить в файл `.env` параметр API_TOKEN - хэш ключа авторизации к серверному API
- Запустить сервер коммандой `npm run start:server`
- Перейти по адресу `http://127.0.0.1:3030/`

### Для запуска клиенсткой части проекта в development режиме

- Запустить webpack-dev-server коммандой `npm run start:client`
- Перейти по адресу `http://127.0.0.1:3030/`

## Тестирование

### e2e тесты

- Установить [selenium-standalone](https://github.com/vvo/selenium-standalone#install--run)
- Запустить selenium сервер `npm run test:selenium`
- Запустить приложение `npm run start`
- Запустить e2e тесты `npm run test:e2e`

### unit тесты

- Запустить unit тесты для сервера `npm run test:server`

### Cценарии проверяемые интеграционными тестами

Главная страница (`http://127.0.0.1:3030/settings`)

- Если настройки не заданы, должна открываться стартовая страница
- Если настройки заданы, должна открываться история сборок
- Осуществляется переход со страницы история сборок на страницу настроек
- Запуск сборки с заданного коммита со страницы история сборок

Страница настроек (`http://127.0.0.1:3030/settings`):

- Осуществляется переход на страницу настроек
- Отображается форма настроек
- Форму нельзя отправить если не заполнены обязательные поля
- Отправка формы после заполнения полей

Страница сборки (`http://127.0.0.1:3030/build/{buildId}`):

- Осуществляется переход на страницу сборки
- Осуществляется переход со страницы сборки на страницу настроек
- На странице сборки отображается карточка сборки
- Осуществляется переход на страницу новой сборки при нажатии на кнопку "Rebuild"

## Типизация

- Трудоёмкость перевода проекта на TypeScript. Самые сложные моменты в работе.

  В целом были небольшие проблемы с объявлением глобальных типов (заработало когда перенёс папку `typings` в директорию `src`) и запуском `ts-node` (пришлось добавить в файл `tsconfig.json` пути у к `typings`). Были вопросы к типизации `redux` экшенов и редьсеров, остановился на самом простом варианте, но хотелось бы избавиться от описания типов `StoreBuildAction` к каждому возвращаемому экшену и объявлению `BuildsActionTypes` как union типа, возможно здесь можно использовать автоматический вывод типов.

- Какие в процессе перевода были найдены ошибки.

  В основом добвил проверки на возможные значения `undefined`.

- Решили ли вы вливать данный PR, или предпочитаете работать с JavaScript? Почему?

  Да, думаю влить PR c TS

## Локализация

Для локализации использовалась библиотека [i18next](https://www.i18next.com) с расширениями [i18next-http-backend](https://github.com/i18next/i18next-http-backend) для получения файлов ресурсов соответствующей локализации и [i18next-browser-languageDetector](https://github.com/i18next/i18next-browser-languageDetector) для определения используемой пользователем локали.

- Как приложение узнает, какой язык выбран у пользователя?

  Модуль [i18next-browser-languageDetector](https://github.com/i18next/i18next-browser-languageDetector) определяет выбранную локаль следующим образом:
    - проверяет ключ `i18next` в `cookie`, иначе
    - проверяет ключ `i18nextLng` в `localStorage`, иначе;
    - обращается к объекту `navigator`

  При изменении языка выбранная пользователем локаль кэшируется в `cookie` и `localStorage`.

- Какие типы контента поддерживают переключение языка и как вы это реализовали?

  Поддерживается локализация строк и дат. Локализация строк осуществляется в рантайме путем поиска по советующему ключу сроки с учетом выбранной пользователем локали (используется хук [useTranslate](https://react.i18next.com/latest/usetranslation-hook)). Для локализации дат используется [date-fns](https://date-fns.org/v1.30.1/docs/format) с передачей соответствующей локали функции форматирования дат.

- Как переводы попадают на клиент? как изменилась сборка приложения?

  Переводы хранятся на сервере в виде статических ресурсов (директория `locales`) и подгружаются в рантайме по требованию модулем [i18next-http-backend](https://github.com/i18next/i18next-http-backend) в зависимости от выбранной локали или при переключении языка приложения.
